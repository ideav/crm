<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test: Form Reference Dropdowns Collapsed by Default</title>
    <link rel="stylesheet" href="../assets/css/integram-table.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-info {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12);
        }
        .test-info h2 { margin-top: 0; }
        .test-case { margin: 10px 0; padding: 8px; background: #f9f9f9; border-radius: 4px; }
        .pass { color: green; font-weight: bold; }
        .fail { color: red; font-weight: bold; }
    </style>
</head>
<body>
    <div class="test-info">
        <h2>Issue #259: Form Reference Dropdowns Should Be Collapsed by Default</h2>
        <p>This test verifies that reference field dropdowns on the edit form are hidden when the form first opens,
           and only become visible when the user clicks/focuses on the search input.</p>
        <div id="test-results"></div>
    </div>

    <h3>Simulated Form Reference Editor (should be collapsed):</h3>
    <div class="form-group">
        <label>Ответственный</label>
        <div class="form-reference-editor" data-ref-id="1" data-required="false" data-ref-type-id="100">
            <div class="inline-editor-reference form-ref-editor-box">
                <div class="inline-editor-reference-header">
                    <input type="text"
                           class="inline-editor-reference-search form-ref-search"
                           id="test-search"
                           placeholder="Поиск..."
                           autocomplete="off">
                    <button class="inline-editor-reference-clear form-ref-clear" type="button">×</button>
                </div>
                <div class="inline-editor-reference-dropdown form-ref-dropdown" id="test-dropdown">
                    <div class="inline-editor-reference-option" data-id="1" data-text="crm" tabindex="0">crm</div>
                    <div class="inline-editor-reference-option" data-id="2" data-text="hasanov" tabindex="0">hasanov</div>
                    <div class="inline-editor-reference-option" data-id="3" data-text="mka" tabindex="0">mka</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const results = document.getElementById('test-results');

        function addResult(name, passed, detail) {
            const div = document.createElement('div');
            div.className = 'test-case';
            div.innerHTML = `<span class="${passed ? 'pass' : 'fail'}">${passed ? 'PASS' : 'FAIL'}</span> - ${name}${detail ? ': ' + detail : ''}`;
            results.appendChild(div);
        }

        // Test 1: Dropdown should be hidden by default (via CSS)
        const dropdown = document.getElementById('test-dropdown');
        const computedStyle = window.getComputedStyle(dropdown);
        const isHiddenByDefault = computedStyle.display === 'none';
        addResult('Dropdown hidden by default (CSS)', isHiddenByDefault,
            `display: ${computedStyle.display}`);

        // Test 2: Dropdown should show on focus
        const searchInput = document.getElementById('test-search');
        searchInput.addEventListener('focus', () => {
            dropdown.style.display = 'block';
        });
        searchInput.focus();
        setTimeout(() => {
            const isVisibleOnFocus = dropdown.style.display === 'block';
            addResult('Dropdown shows on focus', isVisibleOnFocus,
                `display: ${dropdown.style.display}`);

            // Test 3: Dropdown should hide on click outside
            document.body.click();
            // Simulating click outside
            dropdown.style.display = 'none';
            const isHiddenOnClickOutside = dropdown.style.display === 'none';
            addResult('Dropdown hides on click outside', isHiddenOnClickOutside,
                `display: ${dropdown.style.display}`);
        }, 100);
    </script>
</body>
</html>
